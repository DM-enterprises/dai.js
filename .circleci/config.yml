 version: 2
 jobs:
   build:
     docker:
       - image: levity/dapptools-node-latest
     steps:
       - checkout
       - run:
          name: Install dependencies
          command: |
            yarn
            echo 'export PATH=$(yarn global bin):$PATH' >> $BASH_ENV
            source $BASH_ENV
            yarn global add mocki
       - run:
          name: Run tests
          command: |
            source /home/circleci/setup-env.sh
            yarn lerna bootstrap
            yarn build
            mocki run --path packages/dai-plugin-liquidations/.mocki/config.yml
            yarn test:build
            yarn coverage
       - run:
          name: codecov
          command: |
            npm i --no-save codecov
            ./node_modules/.bin/codecov
